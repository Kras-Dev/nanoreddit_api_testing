# Тестирование API проекта.

## Описание проекта:

Проект предназначен для автоматизированного тестирования REST API веб-сервиса, включающего управление постами, 
комментариями, профилями пользователей и аутентификацией. Тесты написаны с использованием фреймворка pytest с акцентом 
на проверку корректности работы эндпоинтов, в том числе аутентификации, авторизации, позитивных и негативных сценариев.

В проекте реализованы клиенты для взаимодействия с API, а также SQL-клиенты для проверки данных на уровне базы. Важным 
аспектом проекта является проверка корректности ответов API, обработки ошибок и соответствия документации реальному
поведению сервиса.

## Используем инструменты:
* **uv** - пакетный менеджер и менеджер виртуальных окружений.
* **Pydantic** - для описания и валидации моделей данных, используется для проверки корректности данных API.
* **Requests** - HTTP-клиент для выполнения API-запросов.
* **Psycopg2** - адаптер PostgreSQL, обеспечивает низкоуровневое взаимодействие с базой данных.
* **SqlAlchemy** - ORM для работы с базой данных и проверки данных на уровне SQL.
* **Pytest** - фреймворк для написания и запуска тестов.
* **Faker** - генерация тестовых данных.
* **Allure** - инструмент для создания и визуализации отчетов о тестировании.

## Установка и настройка:
1. Клонируйте репозиторий.
2. Для запуска тестируемого сервиса и всех зависимостей выполните из корня проекта команду:
```
docker-compose up -d 
```
3. Убедитесь, что все сервисы запущены:
```
docker-compose ps
```
4. Установите зависимости с помощью uv:
```uv add```
5. Установка зависимостей без uv:
- Создайте и активируйте виртуальное окружение.
- Установите утилиту:
```
pip install toml-to-requirements
```
- Сгенерируйте requirements.txt из pyproject.toml:
```
toml-to-req --toml-file pyproject.toml
```
- Установите зависимости:
```
pip install -r requirements.txt 
```
6. Создайте файл `.env` на основе `.env_sample` и заполните необходимые переменные окружения.

## Запуск тестов

Для запуска всех тестов используйте команду:
```
uv run python -m pytest
```
Или, если uv не используется:
```
python -m pytest
```
Для запуска тестов с определёнными маркерами (например, позитивные тесты аутентификации):
```
uv run python -m pytest -m "positive and auth"
```
Для запуска отчётов о тестировании:
```
allure generate -o tests/allure-reports --clean tests/allure-results
```
```
allure open tests/allure-reports
```

## Особенности проекта

- В тестах используется фикстуры для подготовки данных и авторизации пользователей.
- Проверяются как положительные, так и отрицательные сценарии API.
- Проверка данных выполняется на уровне модели с использованием Pydantic.
- В проекте реализованы клиенты, инкапсулирующие логику работы с API и базой данных, что упрощает поддержку и расширение тестов.
- Документация API проверяется на соответствие реальному поведению сервера, включая форматы ответов и обработку ошибок.
- Использование маркеров pytest (`positive`, `negative`, `auth`, `admin` и др.) позволяет гибко управлять запуском тестов.
- Отчеты Allure содержат подробные шаги и метаданные для анализа результатов.
- В папке `bugs/` содержатся описания найденных багов.
